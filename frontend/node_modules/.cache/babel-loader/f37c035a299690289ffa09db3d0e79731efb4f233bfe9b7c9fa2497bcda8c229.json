{"ast":null,"code":"var _jsxFileName = \"/var/www/aayoApp/frontend/src/components/admin/EditUserForm.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport toast from \"react-hot-toast\";\nimport { useUpdateUserDetailsMutation, useGetRolesQuery } from \"../../redux/api/adminApi\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EditUserForm = ({\n  user,\n  onClose,\n  refetch\n}) => {\n  _s();\n  const [updateUser, {\n    isLoading\n  }] = useUpdateUserDetailsMutation();\n  const {\n    data: roleData\n  } = useGetRolesQuery();\n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    roleId: \"\",\n    // use role._id for selection\n    password: \"\"\n  });\n  useEffect(() => {\n    if (user && roleData !== null && roleData !== void 0 && roleData.length) {\n      var _roleData$find;\n      const roleId = typeof user.role === \"string\" ? user.role : (_roleData$find = roleData.find(r => {\n        var _user$role;\n        return r.name === ((_user$role = user.role) === null || _user$role === void 0 ? void 0 : _user$role.name);\n      })) === null || _roleData$find === void 0 ? void 0 : _roleData$find._id;\n      setFormData({\n        name: user.name || \"\",\n        email: user.email || \"\",\n        password: \"\",\n        roleId: roleId || \"\"\n      });\n    }\n  }, [user, roleData]);\n  const handleChange = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    const selectedRole = roleData === null || roleData === void 0 ? void 0 : roleData.find(r => r._id === formData.roleId);\n    if (!selectedRole) {\n      toast.error(\"Please select a valid role.\");\n      return;\n    }\n    const payload = {\n      name: formData.name,\n      email: formData.email,\n      role: selectedRole.name // send name, not ID\n    };\n    if (formData.password.trim()) {\n      payload.password = formData.password;\n    }\n    try {\n      await updateUser({\n        id: user._id,\n        data: payload\n      }).unwrap();\n      toast.success(\"User updated successfully\");\n      onClose();\n      refetch === null || refetch === void 0 ? void 0 : refetch(); // reload list if provided\n    } catch (err) {\n      var _err$data;\n      toast.error((err === null || err === void 0 ? void 0 : (_err$data = err.data) === null || _err$data === void 0 ? void 0 : _err$data.message) || \"Failed to update user\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit,\n    className: \"p-3 border rounded bg-light\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row g-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"form-control\",\n          type: \"text\",\n          name: \"name\",\n          placeholder: \"Name\",\n          value: formData.name,\n          onChange: handleChange,\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"form-control\",\n          type: \"email\",\n          name: \"email\",\n          placeholder: \"Email\",\n          value: formData.email,\n          onChange: handleChange,\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"form-control\",\n          type: \"password\",\n          name: \"password\",\n          placeholder: \"Change Password (optional)\",\n          value: formData.password,\n          onChange: handleChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3\",\n        children: /*#__PURE__*/_jsxDEV(\"select\", {\n          name: \"roleId\",\n          className: \"form-select\",\n          value: formData.roleId,\n          onChange: handleChange,\n          required: true,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"Select Role\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 13\n          }, this), roleData === null || roleData === void 0 ? void 0 : roleData.map(role => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: role._id,\n            children: role.name.charAt(0).toUpperCase() + role.name.slice(1)\n          }, role._id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-12 d-flex justify-content-end gap-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-success\",\n          type: \"submit\",\n          disabled: isLoading,\n          children: \"Save\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-secondary\",\n          type: \"button\",\n          onClick: onClose,\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 5\n  }, this);\n};\n_s(EditUserForm, \"bEZhaDPwfu3cfvpuPeTwwOphOx4=\", false, function () {\n  return [useUpdateUserDetailsMutation, useGetRolesQuery];\n});\n_c = EditUserForm;\nexport default EditUserForm;\nvar _c;\n$RefreshReg$(_c, \"EditUserForm\");","map":{"version":3,"names":["React","useEffect","useState","toast","useUpdateUserDetailsMutation","useGetRolesQuery","jsxDEV","_jsxDEV","EditUserForm","user","onClose","refetch","_s","updateUser","isLoading","data","roleData","formData","setFormData","name","email","roleId","password","length","_roleData$find","role","find","r","_user$role","_id","handleChange","e","value","target","prev","handleSubmit","preventDefault","selectedRole","error","payload","trim","id","unwrap","success","err","_err$data","message","onSubmit","className","children","type","placeholder","onChange","required","fileName","_jsxFileName","lineNumber","columnNumber","map","charAt","toUpperCase","slice","disabled","onClick","_c","$RefreshReg$"],"sources":["/var/www/aayoApp/frontend/src/components/admin/EditUserForm.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport toast from \"react-hot-toast\";\nimport {\n  useUpdateUserDetailsMutation,\n  useGetRolesQuery,\n} from \"../../redux/api/adminApi\";\n\nconst EditUserForm = ({ user, onClose, refetch }) => {\n  const [updateUser, { isLoading }] = useUpdateUserDetailsMutation();\n  const { data: roleData } = useGetRolesQuery();\n\n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    roleId: \"\", // use role._id for selection\n    password: \"\",\n  });\n\n  useEffect(() => {\n    if (user && roleData?.length) {\n      const roleId =\n        typeof user.role === \"string\"\n          ? user.role\n          : roleData.find((r) => r.name === user.role?.name)?._id;\n\n      setFormData({\n        name: user.name || \"\",\n        email: user.email || \"\",\n        password: \"\",\n        roleId: roleId || \"\",\n      });\n    }\n  }, [user, roleData]);\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    setFormData((prev) => ({ ...prev, [name]: value }));\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    const selectedRole = roleData?.find((r) => r._id === formData.roleId);\n    if (!selectedRole) {\n      toast.error(\"Please select a valid role.\");\n      return;\n    }\n\n    const payload = {\n      name: formData.name,\n      email: formData.email,\n      role: selectedRole.name, // send name, not ID\n    };\n\n    if (formData.password.trim()) {\n      payload.password = formData.password;\n    }\n\n    try {\n      await updateUser({ id: user._id, data: payload }).unwrap();\n      toast.success(\"User updated successfully\");\n      onClose();\n      refetch?.(); // reload list if provided\n    } catch (err) {\n      toast.error(err?.data?.message || \"Failed to update user\");\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"p-3 border rounded bg-light\">\n      <div className=\"row g-3\">\n        <div className=\"col-md-3\">\n          <input\n            className=\"form-control\"\n            type=\"text\"\n            name=\"name\"\n            placeholder=\"Name\"\n            value={formData.name}\n            onChange={handleChange}\n            required\n          />\n        </div>\n\n        <div className=\"col-md-3\">\n          <input\n            className=\"form-control\"\n            type=\"email\"\n            name=\"email\"\n            placeholder=\"Email\"\n            value={formData.email}\n            onChange={handleChange}\n            required\n          />\n        </div>\n\n        <div className=\"col-md-3\">\n          <input\n            className=\"form-control\"\n            type=\"password\"\n            name=\"password\"\n            placeholder=\"Change Password (optional)\"\n            value={formData.password}\n            onChange={handleChange}\n          />\n        </div>\n\n        <div className=\"col-md-3\">\n          <select\n            name=\"roleId\"\n            className=\"form-select\"\n            value={formData.roleId}\n            onChange={handleChange}\n            required\n          >\n            <option value=\"\">Select Role</option>\n            {roleData?.map((role) => (\n              <option key={role._id} value={role._id}>\n                {role.name.charAt(0).toUpperCase() + role.name.slice(1)}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        <div className=\"col-12 d-flex justify-content-end gap-2\">\n          <button\n            className=\"btn btn-success\"\n            type=\"submit\"\n            disabled={isLoading}\n          >\n            Save\n          </button>\n          <button className=\"btn btn-secondary\" type=\"button\" onClick={onClose}>\n            Cancel\n          </button>\n        </div>\n      </div>\n    </form>\n  );\n};\n\nexport default EditUserForm;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}