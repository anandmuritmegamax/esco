{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nconst userInfoFromStorage = localStorage.getItem(\"userInfo\") ? JSON.parse(localStorage.getItem(\"userInfo\")) : null;\n\n// ✅ Send OTP to email\nexport const sendOtp = createAsyncThunk(\"auth/sendOtp\", async (email, {\n  rejectWithValue\n}) => {\n  try {\n    const res = await fetch(\"/api/auth/send-otp\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        email\n      })\n    });\n    const data = await res.json();\n    if (!data.success) return rejectWithValue(data.message);\n    return {\n      email,\n      message: data.message\n    };\n  } catch (error) {\n    return rejectWithValue(\"Failed to send OTP\");\n  }\n});\n\n// ✅ Verify OTP\nexport const verifyOtp = createAsyncThunk(\"auth/verifyOtp\", async ({\n  email,\n  otp\n}, {\n  rejectWithValue\n}) => {\n  try {\n    const res = await fetch(\"/api/auth/verify-otp\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        email,\n        otp\n      })\n    });\n    const data = await res.json();\n    if (!data.success) return rejectWithValue(data.message);\n\n    // Save user info to localStorage\n    localStorage.setItem(\"userInfo\", JSON.stringify(data.user));\n    if (data.user.token) {\n      localStorage.setItem(\"token\", data.user.token);\n    }\n    return data.user;\n  } catch (error) {\n    return rejectWithValue(\"Failed to verify OTP\");\n  }\n});\nconst authSlice = createSlice({\n  name: \"auth\",\n  initialState: {\n    userInfo: userInfoFromStorage,\n    isAuthenticated: !!userInfoFromStorage,\n    loading: false,\n    error: null,\n    otpSent: false,\n    email: null\n  },\n  reducers: {\n    loginSuccess: (state, action) => {\n      state.userInfo = action.payload;\n      localStorage.setItem(\"userInfo\", JSON.stringify(action.payload));\n      if (action.payload.token) {\n        localStorage.setItem(\"token\", action.payload.token);\n      }\n      state.isAuthenticated = true;\n    },\n    logout: state => {\n      state.userInfo = null;\n      localStorage.removeItem(\"userInfo\");\n      localStorage.removeItem(\"token\");\n      state.isAuthenticated = false;\n      state.otpSent = false;\n      state.email = null;\n    }\n  },\n  extraReducers: builder => {\n    builder\n    // ✅ Send OTP\n    .addCase(sendOtp.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(sendOtp.fulfilled, (state, action) => {\n      state.loading = false;\n      state.otpSent = true;\n      state.email = action.payload.email;\n    }).addCase(sendOtp.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    })\n\n    // ✅ Verify OTP\n    .addCase(verifyOtp.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(verifyOtp.fulfilled, (state, action) => {\n      state.loading = false;\n      state.userInfo = action.payload;\n      state.isAuthenticated = true;\n      state.otpSent = false;\n      state.email = null;\n    }).addCase(verifyOtp.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    });\n  }\n});\nexport const {\n  loginSuccess,\n  logout\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","userInfoFromStorage","localStorage","getItem","JSON","parse","sendOtp","email","rejectWithValue","res","fetch","method","headers","body","stringify","data","json","success","message","error","verifyOtp","otp","setItem","user","token","authSlice","name","initialState","userInfo","isAuthenticated","loading","otpSent","reducers","loginSuccess","state","action","payload","logout","removeItem","extraReducers","builder","addCase","pending","fulfilled","rejected","actions","reducer"],"sources":["/var/www/aayoApp/frontend-user/src/redux/slices/authSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\n\nconst userInfoFromStorage = localStorage.getItem(\"userInfo\")\n    ? JSON.parse(localStorage.getItem(\"userInfo\"))\n    : null;\n\n// ✅ Send OTP to email\nexport const sendOtp = createAsyncThunk(\n    \"auth/sendOtp\",\n    async (email, { rejectWithValue }) => {\n        try {\n            const res = await fetch(\"/api/auth/send-otp\", {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({ email }),\n            });\n            const data = await res.json();\n\n            if (!data.success) return rejectWithValue(data.message);\n            return { email, message: data.message };\n        } catch (error) {\n            return rejectWithValue(\"Failed to send OTP\");\n        }\n    }\n);\n\n// ✅ Verify OTP\nexport const verifyOtp = createAsyncThunk(\n    \"auth/verifyOtp\",\n    async ({ email, otp }, { rejectWithValue }) => {\n        try {\n            const res = await fetch(\"/api/auth/verify-otp\", {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({ email, otp }),\n            });\n            const data = await res.json();\n\n            if (!data.success) return rejectWithValue(data.message);\n\n            // Save user info to localStorage\n            localStorage.setItem(\"userInfo\", JSON.stringify(data.user));\n            if (data.user.token) {\n                localStorage.setItem(\"token\", data.user.token);\n            }\n\n            return data.user;\n        } catch (error) {\n            return rejectWithValue(\"Failed to verify OTP\");\n        }\n    }\n);\n\nconst authSlice = createSlice({\n    name: \"auth\",\n    initialState: {\n        userInfo: userInfoFromStorage,\n        isAuthenticated: !!userInfoFromStorage,\n        loading: false,\n        error: null,\n        otpSent: false,\n        email: null,\n    },\n    reducers: {\n        loginSuccess: (state, action) => {\n            state.userInfo = action.payload;\n            localStorage.setItem(\"userInfo\", JSON.stringify(action.payload));\n            if (action.payload.token) {\n                localStorage.setItem(\"token\", action.payload.token);\n            }\n            state.isAuthenticated = true;\n        },\n        logout: (state) => {\n            state.userInfo = null;\n            localStorage.removeItem(\"userInfo\");\n            localStorage.removeItem(\"token\");\n            state.isAuthenticated = false;\n            state.otpSent = false;\n            state.email = null;\n        },\n    },\n    extraReducers: (builder) => {\n        builder\n            // ✅ Send OTP\n            .addCase(sendOtp.pending, (state) => {\n                state.loading = true;\n                state.error = null;\n            })\n            .addCase(sendOtp.fulfilled, (state, action) => {\n                state.loading = false;\n                state.otpSent = true;\n                state.email = action.payload.email;\n            })\n            .addCase(sendOtp.rejected, (state, action) => {\n                state.loading = false;\n                state.error = action.payload;\n            })\n\n            // ✅ Verify OTP\n            .addCase(verifyOtp.pending, (state) => {\n                state.loading = true;\n                state.error = null;\n            })\n            .addCase(verifyOtp.fulfilled, (state, action) => {\n                state.loading = false;\n                state.userInfo = action.payload;\n                state.isAuthenticated = true;\n                state.otpSent = false;\n                state.email = null;\n            })\n            .addCase(verifyOtp.rejected, (state, action) => {\n                state.loading = false;\n                state.error = action.payload;\n            });\n    },\n});\n\nexport const { loginSuccess, logout } = authSlice.actions;\nexport default authSlice.reducer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}