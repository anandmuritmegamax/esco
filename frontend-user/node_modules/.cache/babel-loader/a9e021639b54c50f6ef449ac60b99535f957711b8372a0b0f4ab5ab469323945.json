{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nconst userInfoFromStorage = localStorage.getItem(\"userInfo\") ? JSON.parse(localStorage.getItem(\"userInfo\")) : null;\n\n/* ================================\n   ðŸ”¹ Send OTP (Email or Phone)\n================================ */\nexport const sendOtp = createAsyncThunk(\"auth/sendOtp\", async ({\n  email,\n  phone\n}, {\n  rejectWithValue\n}) => {\n  try {\n    const res = await fetch(\"/api/auth/send-otp\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        email,\n        phone\n      })\n    });\n    const data = await res.json();\n    if (!data.success) return rejectWithValue(data.message);\n    return {\n      message: data.message,\n      email: email || null,\n      phone: phone || null\n    };\n  } catch (error) {\n    return rejectWithValue(\"Failed to send OTP\");\n  }\n});\n\n/* ================================\n   ðŸ”¹ Verify OTP (Email or Phone)\n================================ */\nexport const verifyOtp = createAsyncThunk(\"auth/verifyOtp\", async ({\n  email,\n  phone,\n  otp\n}, {\n  rejectWithValue\n}) => {\n  try {\n    const res = await fetch(\"/api/auth/verify-otp\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        email,\n        phone,\n        otp\n      })\n    });\n    const data = await res.json();\n    if (!data.success) return rejectWithValue(data.message);\n\n    // âœ… Always clear old data before saving new user info\n    localStorage.removeItem(\"userInfo\");\n    localStorage.removeItem(\"token\");\n    const newUser = data.user;\n    localStorage.setItem(\"userInfo\", JSON.stringify(newUser));\n    if (newUser.token) localStorage.setItem(\"token\", newUser.token);\n    return newUser;\n  } catch (error) {\n    return rejectWithValue(\"Failed to verify OTP\");\n  }\n});\n\n/* ================================\n   ðŸ”¹ Auth Slice\n================================ */\nconst authSlice = createSlice({\n  name: \"auth\",\n  initialState: {\n    userInfo: userInfoFromStorage,\n    isAuthenticated: !!userInfoFromStorage,\n    loading: false,\n    error: null,\n    otpSent: false,\n    email: null,\n    phone: null\n  },\n  reducers: {\n    // âœ… For normal email/password login\n    loginSuccess: (state, action) => {\n      // Clear any previous data\n      localStorage.removeItem(\"userInfo\");\n      localStorage.removeItem(\"token\");\n      const newUser = action.payload;\n      state.userInfo = newUser;\n      state.isAuthenticated = true;\n      localStorage.setItem(\"userInfo\", JSON.stringify(newUser));\n      if (newUser.token) {\n        localStorage.setItem(\"token\", newUser.token);\n      }\n    },\n    // âœ… Logout user\n    logout: state => {\n      state.userInfo = null;\n      state.isAuthenticated = false;\n      state.loading = false;\n      state.error = null;\n      state.otpSent = false;\n      state.email = null;\n      state.phone = null;\n      localStorage.removeItem(\"userInfo\");\n      localStorage.removeItem(\"token\");\n    },\n    updateUserAvatar: (state, action) => {\n      if (state.userInfo) {\n        state.userInfo.avatar = action.payload;\n      }\n    }\n  },\n  /* ===========================\n     ðŸ”¹ Async Reducers\n  ============================ */\n  extraReducers: builder => {\n    builder\n    // Send OTP\n    .addCase(sendOtp.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(sendOtp.fulfilled, (state, action) => {\n      state.loading = false;\n      state.otpSent = true;\n      state.email = action.payload.email;\n      state.phone = action.payload.phone;\n    }).addCase(sendOtp.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    })\n\n    // Verify OTP\n    .addCase(verifyOtp.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(verifyOtp.fulfilled, (state, action) => {\n      state.loading = false;\n      state.userInfo = action.payload;\n      state.isAuthenticated = true;\n      state.otpSent = false;\n      state.email = null;\n      state.phone = null;\n    }).addCase(verifyOtp.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    });\n  }\n});\nexport const {\n  loginSuccess,\n  logout\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","userInfoFromStorage","localStorage","getItem","JSON","parse","sendOtp","email","phone","rejectWithValue","res","fetch","method","headers","body","stringify","data","json","success","message","error","verifyOtp","otp","removeItem","newUser","user","setItem","token","authSlice","name","initialState","userInfo","isAuthenticated","loading","otpSent","reducers","loginSuccess","state","action","payload","logout","updateUserAvatar","avatar","extraReducers","builder","addCase","pending","fulfilled","rejected","actions","reducer"],"sources":["/var/www/aayoApp/frontend-user/src/redux/slices/authSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\n\nconst userInfoFromStorage = localStorage.getItem(\"userInfo\")\n    ? JSON.parse(localStorage.getItem(\"userInfo\"))\n    : null;\n\n/* ================================\n   ðŸ”¹ Send OTP (Email or Phone)\n================================ */\nexport const sendOtp = createAsyncThunk(\n    \"auth/sendOtp\",\n    async ({ email, phone }, { rejectWithValue }) => {\n        try {\n            const res = await fetch(\"/api/auth/send-otp\", {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({ email, phone }),\n            });\n\n            const data = await res.json();\n            if (!data.success) return rejectWithValue(data.message);\n\n            return {\n                message: data.message,\n                email: email || null,\n                phone: phone || null,\n            };\n        } catch (error) {\n            return rejectWithValue(\"Failed to send OTP\");\n        }\n    }\n);\n\n/* ================================\n   ðŸ”¹ Verify OTP (Email or Phone)\n================================ */\nexport const verifyOtp = createAsyncThunk(\n    \"auth/verifyOtp\",\n    async ({ email, phone, otp }, { rejectWithValue }) => {\n        try {\n            const res = await fetch(\"/api/auth/verify-otp\", {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({ email, phone, otp }),\n            });\n\n            const data = await res.json();\n            if (!data.success) return rejectWithValue(data.message);\n\n            // âœ… Always clear old data before saving new user info\n            localStorage.removeItem(\"userInfo\");\n            localStorage.removeItem(\"token\");\n\n            const newUser = data.user;\n            localStorage.setItem(\"userInfo\", JSON.stringify(newUser));\n            if (newUser.token) localStorage.setItem(\"token\", newUser.token);\n\n            return newUser;\n        } catch (error) {\n            return rejectWithValue(\"Failed to verify OTP\");\n        }\n    }\n);\n\n/* ================================\n   ðŸ”¹ Auth Slice\n================================ */\nconst authSlice = createSlice({\n    name: \"auth\",\n    initialState: {\n        userInfo: userInfoFromStorage,\n        isAuthenticated: !!userInfoFromStorage,\n        loading: false,\n        error: null,\n        otpSent: false,\n        email: null,\n        phone: null,\n    },\n    reducers: {\n        // âœ… For normal email/password login\n        loginSuccess: (state, action) => {\n            // Clear any previous data\n            localStorage.removeItem(\"userInfo\");\n            localStorage.removeItem(\"token\");\n\n            const newUser = action.payload;\n            state.userInfo = newUser;\n            state.isAuthenticated = true;\n\n            localStorage.setItem(\"userInfo\", JSON.stringify(newUser));\n            if (newUser.token) {\n                localStorage.setItem(\"token\", newUser.token);\n            }\n        },\n\n        // âœ… Logout user\n        logout: (state) => {\n            state.userInfo = null;\n            state.isAuthenticated = false;\n            state.loading = false;\n            state.error = null;\n            state.otpSent = false;\n            state.email = null;\n            state.phone = null;\n\n            localStorage.removeItem(\"userInfo\");\n            localStorage.removeItem(\"token\");\n        },\n\n        updateUserAvatar: (state, action) => {\n            if (state.userInfo) {\n                state.userInfo.avatar = action.payload;\n            }\n        },\n    },\n\n    /* ===========================\n       ðŸ”¹ Async Reducers\n    ============================ */\n    extraReducers: (builder) => {\n        builder\n            // Send OTP\n            .addCase(sendOtp.pending, (state) => {\n                state.loading = true;\n                state.error = null;\n            })\n            .addCase(sendOtp.fulfilled, (state, action) => {\n                state.loading = false;\n                state.otpSent = true;\n                state.email = action.payload.email;\n                state.phone = action.payload.phone;\n            })\n            .addCase(sendOtp.rejected, (state, action) => {\n                state.loading = false;\n                state.error = action.payload;\n            })\n\n            // Verify OTP\n            .addCase(verifyOtp.pending, (state) => {\n                state.loading = true;\n                state.error = null;\n            })\n            .addCase(verifyOtp.fulfilled, (state, action) => {\n                state.loading = false;\n                state.userInfo = action.payload;\n                state.isAuthenticated = true;\n                state.otpSent = false;\n                state.email = null;\n                state.phone = null;\n            })\n            .addCase(verifyOtp.rejected, (state, action) => {\n                state.loading = false;\n                state.error = action.payload;\n            });\n    },\n});\n\nexport const { loginSuccess, logout } = authSlice.actions;\nexport default authSlice.reducer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}